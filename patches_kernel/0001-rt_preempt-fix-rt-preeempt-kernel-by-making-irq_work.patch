From 4960cc3347a2b442b0a26ef01a2be2209ca9dc4b Mon Sep 17 00:00:00 2001
From: Marek Bykowski <marek.bykowski@gmail.com>
Date: Mon, 3 Dec 2018 04:36:32 -0600
Subject: [PATCH 1/4] rt_preempt: fix rt preeempt kernel by making irq_work run
 in hard irq context

---
 kernel/sched/core.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/kernel/sched/core.c b/kernel/sched/core.c
index 0862abbd4d7c..ab8285b86d45 100644
--- a/kernel/sched/core.c
+++ b/kernel/sched/core.c
@@ -6340,6 +6340,7 @@ static int init_rootdomain(struct root_domain *rd)
 	rd->rto_cpu = -1;
 	raw_spin_lock_init(&rd->rto_lock);
 	init_irq_work(&rd->rto_push_work, rto_push_irq_work_func);
+	rd->rto_push_work.flags |= IRQ_WORK_HARD_IRQ;
 #endif
 
 	init_dl_bw(&rd->dl_bw);
-- 
2.16.2

